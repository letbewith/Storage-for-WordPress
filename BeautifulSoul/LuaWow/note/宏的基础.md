
## 宏的基本常识
    　 宏是一个脚本，发送到服务器端执行。
               这个脚本由一组命令序列构成，长度不超过255个字符。
               比如说 释放 几组技能  马上就放出来了啊  
               本地执行  和 送达到服务器 去计算 什么的 这里不就深究了
               
## 宏最主要的应用是带有判断的施法
     Code(c):
     
     /cast [表达式1-1][表达式1-2]技能1;[表达式2]技能2;技能3
     
     --宏的模型
     
     [项1,项2,项3, ...]
     
     --表达式的模型
     
     --注：表达式中定义单位target=或@不是一种判断条件，但它重新指定了后续所有涉及目标的判断和最终技能施放的对象。
            比如指定了@mouseover后，后续的help/exists/dead之类的判断都会基于鼠标悬停的单位。
            
            
## 语法   
      每一个命令，由一个/ 开头


       例如/say /script 等等
    　　      /script 后面跟随脚本特有的语句和函数
    　　你可以罗列多个/script命令在一个脚本里，也可以在一个/script命令中写多个函数，这都可以。
    　　因为宏就是依次执行所有的命令，
       所以不需要在宏的最后添加end 标记，或在命令之间加; 
       
       
       事实上，end标记 是if语句的组成部分，你在写if语句时才用到end关键字。
       命令和命令之间用换行或; 隔开都可以，我喜欢用换行..呵呵，省掉不必要的; 
       代码也清楚些 + 1
       
       　常用的if语句语法如下：     条件表达式不需要在外面套括号
       　　/script if [条件表达式] then [命令序列] end
       　　or
       　　/script if [条件表达式] then [命令序列1] else [命令序列2] end
       
       条件表达式 中 相等用 == ， 否定用not， 不等于可以写 not (A == B),暴雪没有提供!= 作为不等于，很奇怪。 例子：
       　　if sword == GetInventoryItemLink("player", 16) then ....
       　　if not (sword == GetInventoryItemLink("player", 16)) then ....
       　　注1，这里的sword是全局变量。每一个全局变量的生命周期是一次登陆中从声明变量到退出魔兽，通常在每次登陆后额外运行一个设定宏来设定我们所需要的全局变量。
            注2，GetInventoryItemLink()是一个取装备link的函数，
            　　GetInventoryItemLink("player", number)是从人物身上取装备的link，number代表人物装备画面的不同槽， 头部，颈部，依次递增，于是16代表主手武器，17代表副手武器
            　　GetInventoryItemLink("player", 16) 就代表了主手武器的link
           以前确实有这个  现在不知道有没有变动
## 技能整合
    
    对于把多个技能整合进一个/cast命令里，在不同的条件下自动判断施放不同的技能，只有一条格式法则：不同技能之间用分号;
    间隔。具体可以参照本章开头提出的宏模型。
    
    要注意，一个/cast任何情况下至多只能施放一个技能
    这里存在一个公用CD的问题 如果有CD 就不能放了 宏就会被卡住
    如果要做到一键同时放出两个或更多的技能，必须有多行/cast命令，这就是技能堆叠。这种宏通常用于爆发技能，喝药开饰品开技能需要同时完成。
    至多只能拥有一个产生/受到GCD影响的技能，幸运的是爆发类技能和药水等物品几乎都设计成不占用GCD
    这里用宏编写 明显比手按要快捷很多  而且动作栏 位置有限 紧急的情况下 很大几率也不知道要点哪里
    
    Code(c): fs 爆发
    
    1:#showtooltip
    
    2:/cast 奥术强化
    
    3:/use 13
    
    4:/use 14
        这样的宏是可行的，因为饰品和[奥术强化]本身并不产生GCD，甚至再加两行
    
    Code(c):
    
    /cast 气定神闲

    /cast 奥术冲击
    
    形如以下的宏是非法的：
    
    Code(c):
    
    1:#showtooltip
    
    2:/cast 驱邪术
    
    3:/cast 审判
    
    4:/cast 十字军打击
    
    因为三者都产生GCD和/或被GCD影响，最终的效果是只相当于第一行[驱邪]有用。不要妄图这种方法能实现按优先级施放技能。
## 技能替代是一个十分有意思的机制，自CTM引进
    这种机制允许某[基础技能]在特殊情况下被另一个[替代技能]替代，而即便在替代的情况下，
    通过宏命令施放[基础技能]时会自动定向到[替代技能]，
    其最终的结果是正常施放[替代技能]，宏的图标也会随之变化。
    
    涉及到 职业和天赋
           同一个技能 在不同天赋 或者 状态下的表现不一样
           
       举例：神牧的[圣言术：罚]在黄轮和蓝轮下转换成[静]和[佑]，只要宏
       
       Code(c):
       
       1:#showtooltip
       
       2:/cast 圣言术：罚
       
       就能自动根据轮的颜色转换技能，但因为这是[罚]被单向地替代，反过来如果宏里写[静]或[佑]，在红轮下就会放不出技能。
       目前7.1 我看了下技能有做调整 估计是用不了了
            
## 写宏的灵魂：逻辑和优先级     
    Code(c):
    
    1:#showtooltip
    
    2:/cast [help,dead][mod:shift,help][mod:shift,@player]Soulstone;[mod]Soul Link;Unending Resolve
    
    3:/targetlasttarget [help,dead]
    
    4:--比如这个术士宏，它的逻辑等价于：
    
    5:--如果[目标死亡且可协助]或[按住shift并且目标可协助]或[其他按住shift的情况下对自己]施放[灵魂石]
        
    首先[help,dead]指定了[目标死亡且可协助]的情况，它是优先级最高的，只要满足这两个条件，其他任何条件不管满足不满足都会战复目标。
    
    [mod:shift,help]这一判断代表[按住shift并且目标可协助]，但是它还有个隐藏条件。因为要判断到这一层，首先必须前者[help,dead]为假
    
        shift 就是绑石头啦
        
    笔者个人的习惯是修饰键优先级比悬停高，也就是按了修饰键应该尝试对焦点放而不是对悬停解诅咒；
    而同时悬停的优先级应该比目标的优先级高。这个优先级可以根据自身需要调整。
    
## 编写宏 结合个人 PVP 战斗意识
    
    那么整理之后的优先级就是：
    
    第一优先级：焦点反制敌对目标，判断式[mod,@focus,exists,harm]
    
    第二优先级：悬停解可协助目标诅咒，判断式[@mouseover,exists,help]
    
    第三优先级：对友善目标解诅咒，判断式[help]
    
    第四优先级：敌对目标反制，判断式[harm]
    
    第五优先级：反制，无判断式(恒真)
    
    *要注意，harm和help有关系，但并不是help=noharm或者harm=nohelp。harm代表目标可攻击，
    help代表目标可协助(能给他加血上buff等)，此外还有一种既不能攻击也不能协助的状态，称为“被动(Passive)”。
    
    现在可以直接写出宏了，那就是：
    
    Code(c):
    
    1:#showtooltip
    
    2:/cast [mod,@focus,exists,harm]法术反制;[@mouseover,exists,help][help]解除诅咒;[harm]法术反制;法术反制
    
    3:--第一行的#showtooltip不是命令行，它的作用是能在鼠标提示上显示技能的有关信息
    
    这个宏运作起来是符合要求的，但是可以继续优化。从逻辑上而言，第四与第五优先级可以合并，而且exists没必要与harm和help连用。因此最终的宏是：
    
    Code(c):
    
    1:#showtooltip
    
    2:/cast [mod,@focus,harm]法术反制;[@mouseover,help][help]解除诅咒;法术反制
    
## 终极形态：宏的优化
    宏有字数限制，每个汉字或是英文字母都占1字，最后还有个换行符占1字，总共加起来不能超过256个字符(不包括标题行)。因此在一些特殊的环境下，写出来的宏会很长很长，那么优化有时候就有必要。
    
    优化的目的是让宏看起来更整洁优美，更精短同时兼顾功能，以方便日后修改等操作。
    
    优化一：注意判断之间的关系，去掉多余的判断项。
    
    Code(c):
    
    1:#showtooltip
    
    2:/cast [mod]技能1;[nomod]技能2
    
    后面的nomod判断就是多余的，可删除。 随便吧 不删也行 看个人喜好
    
    优化二：去掉多余的exists。
    
    当exists与harm，help，dead等本身就需要判断“目标状态”的项目在同一个方括号内连用时，exists多余。
    因为后者为真，exists一定为真；相反exists为假后者一定为假。
            这里倒是挺实用的
            
            /cast [target=focus,exists][target=player]圣光闪现
            
    Code(c):
    
    1:#showtooltip
    
    2:/cast [@mouseover,exists,help][]快速治疗  help 已经是在判断了 别重复判断了 虽然很微弱但是 提高代码执行效率 
    
    其中的exists可以删除。
    
    优化三：恒真判断([])
    
    它就是一个空的方括号，在任何条件下都返回true。当最后的收尾技能和前一个相同时，不需要使用分号重复写技能名，只需要一个空括号即可。
    
    比如还是上面的快速治疗宏，其等同于：
    
    Code(c):
    
    1:#showtooltip
    
    2:/cast [@mouseover,help]快速治疗;快速治疗
    
    3:--可以简并成
    
    4:#showtooltip
    
    5:/cast [@mouseover,help][]快速治疗
    
    优化四：灵活运用/stopmacro
    
    它的作用是在这一行终止当前宏运行，可以加判断式。
    
    优化五：慎用nochannelling项
    
    特别是暗牧！
    
    Code(c): 精神鞭笞防打断宏
    
    1:#showtooltip
    
    2:/cast [nochannelling:精神鞭笞]精神鞭笞
    
    若你的延迟高，这宏会严重浪费输出时间。
    原因是它需要本地客户端停止引导才会允许施放，而此时服务器早就引导完了。
    正确的方法是用显示即使延迟的施法条插件，比如Quartz，在引导进入红区时施放下个鞭笞。

    合并下 宏 + 比较合适  愈合祷言 现在不是顺发了 具体使用的时候看情况吧
    #showtooltip
    /cast [mod:alt,@player][help]愈合祷言
    /cast [nochanneling:精神鞭笞] 精神鞭笞
           
                     
    优化六：注释符(--，两个连写的减号)
    
    一种特殊命令，写在一行的最开头，作用是把一整个命令行全部注释掉，让其不产生任何效果。
    
    实用性的例子如打断施法+反制宏，当插了反制雕文的时候，打断施法这一行就没有必要了。这时候就可以把宏改写成如下形式：
    
    Code(c):
    
    1:#showtooltip
    
    2:--/stopcasting
    
    3:/cast 法术反制
    
    注意注释符的用法。下次需要他有作用的时候，简单地删除注释符即可。用它保存暂时不用的长段复杂代码，需要时删除以释放，方便有效。
    
    优化七：图标选问号，#showtooltip后面留空
    
    如果是整合技能宏，一般情况下图标都选问号，这样图标就会跟随技能变化。而#showtooltip这一行一般不需要后面附加技能。当在特殊情况下，例如写一个气定奥冲绑定宏，气定在奥冲之前，但是非要把图标成奥冲的时候，才写成：
    
    Code(c):
    
    1:#showtooltip 奥术冲击
    
    2:/cast 气定神闲
    
    3:/cast 奥术冲击
    
    
    
    